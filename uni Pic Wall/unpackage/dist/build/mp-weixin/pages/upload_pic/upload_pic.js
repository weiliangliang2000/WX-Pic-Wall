"use strict";const e=require("../../common/vendor.js"),l=require("../../utils/request.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-data-select"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js"))();const o={__name:"upload_pic",setup(o){const a=e.ref([{value:0,text:"自然风景"},{value:1,text:"建筑风格"},{value:2,text:"美女明星"},{value:3,text:"AI美图"},{value:4,text:"动漫游戏"},{value:5,text:"可爱萌宠"},{value:6,text:"体育运动"},{value:7,text:"帅哥靓仔"},{value:8,text:"其他"}]),u=["自然风景","建筑风格","美女明星","AI美图","动漫游戏","可爱萌宠","体育运动","帅哥靓仔","其他"],s=e.ref(""),t=e.ref(""),n=e.ref(""),i=e.ref(""),r=e.ref([]);function c(){console.log("**********************:",u[s.value])}function d(){r.value=[],e.index.chooseImage({count:9,sizeType:["original"],sourceType:["album"],success:o=>{o.tempFilePaths.forEach((e=>{r.value.push({filePath:e,progress:0})})),console.log("文件路径:",o),e.index.showLoading({title:"uploading",mask:!0});let a=0;r.value.forEach(((o,i)=>{!function(o,a,i){e.index.uploadFile({url:l.url+"upload_pic",filePath:o,name:"file",timeout:6e5,formData:{tag:t.value,category_id:u[s.value],description:n.value},success:e=>{console.log("upload success:",e.data,"for file:",o),r.value[a].progress=100,i()},fail:l=>{console.error("upload fail:",l,"for file:",o),e.index.showToast({title:l,icon:"none",duration:3e3}),i()}}).onProgressUpdate((e=>{r.value[a].progress=e.progress,console.log("上传进度:",e.progress,"for file:",o)}))}(o.filePath,i,(()=>{a++,a===r.value.length&&(e.index.hideLoading(),e.index.showToast({title:"上传成功",icon:"success",duration:2e3}),console.log("All files uploaded successfully"))}))}))}})}function p(){console.log(i.value),e.index.request({url:l.url+"delete_pic",method:"GET",data:{id:i.value},success:l=>{e.index.showToast({title:"success delete",icon:"none",duration:2e3})}})}const v=e.ref([]);function f(){console.log(i.value),e.index.request({url:l.url+"wallpapers/"+i.value,method:"GET",success:l=>{200===l.statusCode?(v.value=l.data,e.index.setStorageSync("pic",l.data),v.value=v.value[0],console.log("搜索的图片信息：",v.value[0])):(console.error("Error:",l.data.message),e.index.showToast({title:"Failed to search wallpapers",icon:"none",duration:3e3}))}})}function g(){f(),e.index.navigateTo({url:"/pages/preview/preview?id="+v.value.id}),console.log("搜索图片的id：",v.value.id)}function h(){v.value=null,i.value=null}return(l,o)=>e.e({a:e.o(f),b:e.o(h),c:e.o(h),d:e.o(h),e:e.o((e=>i.value=e)),f:e.p({placeholder:"请输入要删除的图片ID",modelValue:i.value}),g:e.o(p),h:i.value},i.value?{i:v.value.image_url,j:e.o(g)}:{},{k:e.f(r.value,((l,o,a)=>({a:l.filePath,b:l.progress+"%",c:e.t(l.progress),d:o}))),l:e.o((e=>t.value=e)),m:e.p({placeholder:"请输入图片标签",modelValue:t.value}),n:e.o((e=>n.value=e)),o:e.p({placeholder:"请输入图片描述",modelValue:n.value}),p:e.o(c),q:e.o((e=>s.value=e)),r:e.p({placeholder:"请选择分类",localdata:a.value,modelValue:s.value}),s:e.o(d)})}},a=e._export_sfc(o,[["__scopeId","data-v-77052d01"]]);wx.createPage(a);
